<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
</head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />

<body>
    <div class="inp">
        <input type="file" name="audio" id="audio_file">
    </div>
    <div class="btn">
        <button type="submit" id="btn-submit" onclick="submit()">Submit</button>
    </div>
    <textarea name="finaltext" id="newtext" cols="70" rows="20"></textarea>
    <!-- 99737232209 -->
    <button id="downloadButton">Download JSON</button>

    <script>
        document.getElementById('downloadButton').addEventListener('click', function () {
            const audio = document.getElementById("audio_file");
            audioname = audio.files[0].name;
            var textareaContent = document.getElementById('newtext').value;
            var jsonObject = textareaContent
            var jsonString = JSON.stringify(jsonObject, null, 2);
            var blob = new Blob([jsonString], { type: 'application/json' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = `${audioname}.json`;
            a.click();
            URL.revokeObjectURL(url);
        });

    </script>

</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
<script>
    let newDATA;
    document.querySelector("#newtext").value = newDATA;
    console.log(newDATA)
    function submit() {
        const audio = document.getElementById("audio_file");
        audiofile = audio.files[0];
        audioname = audio.files[0].name;
        console.log(audioname);
        const formData = new FormData();
        formData.append("audio", audiofile);
        formData.append("name", audioname);
        console.log(audiofile);
        axios.post("http://127.0.0.1:8000/manual/TR/", formData)

            .then((response) => {
                console.log(response.data);
                console.log(typeof (response.data));
                newDATA = response.data;
                document.querySelector("#newtext").value =
                    response.data;

            })
    }
</script>

</html>